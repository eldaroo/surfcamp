"use strict";(()=>{var e={};e.id=249,e.ids=[249],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},4169:(e,o,r)=>{r.r(o),r.d(o,{headerHooks:()=>f,originalPathname:()=>b,requestAsyncStorage:()=>m,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>p,staticGenerationBailout:()=>D});var a={};r.r(a),r.d(a,{POST:()=>POST});var s=r(884),t=r(6132),n=r(5798),i=r(3935),u=r(3614),c=r(7050);let l={"casa-playa":4234,"casitas-privadas":15507,"casas-deluxe":5348};async function POST(e){try{let o=await e.json(),{checkIn:r,checkOut:a,guests:s,contactInfo:t,roomTypeId:d="casa-playa",activities:m=[],paymentIntentId:p}=o,g=(0,i.E$)();if(console.log("\uD83C\uDFE8 ===== PROCESSING RESERVATION ====="),console.log("\uD83C\uDFE8 Booking data:",{checkIn:r,checkOut:a,guests:s,roomTypeId:d,contactInfo:t?`${t.firstName} ${t.lastName}`:"Missing",paymentIntentId:p,bookingReference:g}),!u.b.isConfigured()){console.log("\uD83C\uDFAF LobbyPMS not configured, using demo mode");try{let e=`\xa1Hola! Se confirm\xf3 una reserva en SurfCamp para las fechas ${r} a ${a} para ${s} hu\xe9sped(es).`,o=await (0,c.U3)("+5491162802566",e);console.log("\uD83D\uDCF1 WhatsApp confirmation sent (demo mode - no LobbyPMS):",o)}catch(e){console.error("âŒ WhatsApp error (non-blocking):",e)}let e={success:!0,reservationId:`DEMO-${g}`,bookingReference:g,status:"confirmed",message:"Reserva confirmada exitosamente (modo demo)",demoMode:!0,details:{roomType:d,categoryId:l[d]||4234,guest:`${t.firstName} ${t.lastName}`,dates:`${r} - ${a}`,guests:s,activities:m}};return console.log("âœ… Demo reservation created:",e),n.Z.json(e)}let f=l[d];if(!f)return console.error("âŒ Invalid room type:",d),n.Z.json({error:`Tipo de habitaci\xf3n no v\xe1lido: ${d}`},{status:400});console.log("\uD83D\uDD04 Mapping room type:",{roomTypeId:d,categoryId:f,mappingUsed:l});let formatDateForLobbyPMS=e=>{let o=new Date(e);return o.toISOString().split("T")[0]},D=formatDateForLobbyPMS(r),b=formatDateForLobbyPMS(a);console.log("\uD83D\uDCC5 Date formatting:",{original:{checkIn:r,checkOut:a},formatted:{checkIn:D,checkOut:b}});let x={start_date:D,end_date:b,guest_count:s,total_adults:s,total_children:0,guest_name:`${t.firstName} ${t.lastName}`,holder_name:`${t.firstName} ${t.lastName}`,guest_email:t.email,guest_phone:t.phone,guest_document:t.dni,customer_document:t.dni,customer_nationality:"ES",category_id:f,room_type_id:d,booking_reference:g,source:"Surfcamp Santa Teresa",payment_intent_id:p,status:"confirmed",notes:`ðŸ„â€â™‚ï¸ RESERVA DESDE SURFCAMP SANTA TERESA ðŸ„â€â™‚ï¸

Detalles de la reserva:
- Web: surfcamp-santa-teresa.com
- Referencia: ${g}
- Hu\xe9sped: ${t.firstName} ${t.lastName}
- DNI: ${t.dni}
- Email: ${t.email}
- Tel\xe9fono: ${t.phone}
- Pago: ${p}`,special_requests:`Reserva realizada a trav\xe9s de la p\xe1gina web oficial de Surfcamp Santa Teresa. Referencia de pago: ${p}`};console.log("\uD83D\uDCE1 Sending to LobbyPMS:",x);try{let e=await u.b.createBooking(x);console.log("âœ… LobbyPMS reservation successful:",e);try{let e=`\xa1Hola! Se confirm\xf3 una reserva en SurfCamp para las fechas ${r} a ${a} para ${s} hu\xe9sped(es).`,o=await (0,c.U3)("+5491162802566",e);console.log("\uD83D\uDCF1 WhatsApp confirmation sent:",o)}catch(e){console.error("âŒ WhatsApp error (non-blocking):",e)}return n.Z.json({success:!0,reservationId:e.reservation_id||e.id,bookingReference:g,status:e.status||"confirmed",message:"Reserva confirmada exitosamente",demoMode:!1,lobbyPMSResponse:e})}catch(e){console.error("âŒ LobbyPMS booking error:",{message:e.message,status:e.response?.status,data:e.response?.data,bookingData:x}),console.log("\uD83D\uDD04 Falling back to demo mode due to LobbyPMS error");try{let e=`\xa1Hola! Se confirm\xf3 una reserva en SurfCamp para las fechas ${r} a ${a} para ${s} hu\xe9sped(es).`,o=await (0,c.U3)("+5491162802566",e);console.log("\uD83D\uDCF1 WhatsApp confirmation sent (demo mode):",o)}catch(e){console.error("âŒ WhatsApp error (non-blocking):",e)}return n.Z.json({success:!0,reservationId:`FALLBACK-${g}`,bookingReference:g,status:"confirmed",message:"Reserva confirmada exitosamente (modo demo - LobbyPMS no disponible)",demoMode:!0,fallbackReason:e.message,originalError:e.response?.data})}}catch(o){console.error("âŒ General reservation error:",o);let e=(0,i.E$)();return n.Z.json({success:!0,reservationId:`ERROR-FALLBACK-${e}`,bookingReference:e,status:"confirmed",message:"Reserva confirmada exitosamente (modo demo - error del sistema)",demoMode:!0,error:o.message,note:"Tu reserva ha sido registrada. Nos pondremos en contacto contigo para confirmar los detalles."})}}let d=new s.AppRouteRouteModule({definition:{kind:t.x.APP_ROUTE,page:"/api/reserve/route",pathname:"/api/reserve",filename:"route",bundlePath:"app/api/reserve/route"},resolvedPagePath:"C:\\Users\\loko_\\OneDrive\\Desktop\\Escritorio\\surfcamp\\app\\api\\reserve\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:p,serverHooks:g,headerHooks:f,staticGenerationBailout:D}=d,b="/api/reserve/route"}};var o=require("../../../webpack-runtime.js");o.C(e);var __webpack_exec__=e=>o(o.s=e),r=o.X(0,[997,806,117,943,614,50,935],()=>__webpack_exec__(4169));module.exports=r})();