"use strict";(()=>{var e={};e.id=325,e.ids=[325],e.modules={517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9491:e=>{e.exports=require("assert")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},7147:e=>{e.exports=require("fs")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},2037:e=>{e.exports=require("os")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},6224:e=>{e.exports=require("tty")},7310:e=>{e.exports=require("url")},3837:e=>{e.exports=require("util")},9796:e=>{e.exports=require("zlib")},82:(e,a,o)=>{o.r(a),o.d(a,{headerHooks:()=>g,originalPathname:()=>m,requestAsyncStorage:()=>n,routeModule:()=>c,serverHooks:()=>p,staticGenerationAsyncStorage:()=>u,staticGenerationBailout:()=>y});var s={};o.r(s),o.d(s,{POST:()=>POST});var l=o(884),r=o(6132),i=o(5798),t=o(3614);async function POST(e){try{console.log("\uD83C\uDFAF Availability API called - START");let a=await e.json(),{checkIn:o,checkOut:s,guests:l}=a;console.log("\uD83C\uDFAF Availability API called with:",{checkIn:o,checkOut:s,guests:l});try{console.log("\uD83D\uDE80 Calling LobbyPMS API with CORRECT endpoint...");let e=await t.b.getAvailableRooms({start_date:o,end_date:s});console.log("\uD83D\uDCCB ===== AVAILABILITY DATA RECEIVED ====="),console.log("\uD83D\uDCCB Total days received:",e.length),console.log("\uD83D\uDCCB Raw availability data:",JSON.stringify(e,null,2));let a={"casa-playa":{roomTypeId:"casa-playa",roomTypeName:"Casa de Playa (Cuarto Compartido)",maxGuests:8,categories:[],availableRoomsByDay:[],prices:[]},"casitas-privadas":{roomTypeId:"casitas-privadas",roomTypeName:"Casitas Privadas",maxGuests:2,categories:[],availableRoomsByDay:[],prices:[]},"casas-deluxe":{roomTypeId:"casas-deluxe",roomTypeName:"Casas Deluxe",maxGuests:2,categories:[],availableRoomsByDay:[],prices:[]}},l=new Date(o),r=new Date(s),c=Math.ceil((r.getTime()-l.getTime())/864e5);console.log(`📅 Check-in: ${o}, Check-out: ${s}`),console.log(`📅 Nights needed: ${c}`),console.log(`📅 Will only process first ${c} days for availability`);let n={},u=Math.min(c,e.length);e.slice(0,u).forEach((e,o)=>{console.log(`📅 Processing day ${o+1}: ${e.date}`),e.categories&&Array.isArray(e.categories)&&e.categories.forEach((e,s)=>{console.log(`🏠 ===== PROCESSING CATEGORY ${s+1} =====`),console.log(`🏠 Category ID: ${e.category_id}`),console.log(`🏠 Category name: "${e.name}"`),console.log(`🏠 Available rooms: ${e.available_rooms}`),console.log(`🏠 Prices:`,e.prices);let l=(e.name||"").toLowerCase(),r=e.prices?.find(e=>1===e.people)?.value;n[l]||(n[l]={availableByDay:Array(c).fill(0),prices:[],roomType:""}),n[l].availableByDay[o]=e.available_rooms||0,"casa playa"===l?(console.log("✅ Matched as Casa de Playa (Cuarto Compartido)"),a["casa-playa"].categories.push(e),n[l].roomType="casa-playa",r&&r>0&&(e.available_rooms||0)>0&&(a["casa-playa"].prices.push(r),n[l].prices.push(r))):"casita 3"===l||"casita 4"===l||"casita 7"===l?(console.log("✅ Matched as Casita Privada"),a["casitas-privadas"].categories.push(e),n[l].roomType="casitas-privadas",r&&r>0&&(e.available_rooms||0)>0&&(a["casitas-privadas"].prices.push(r),n[l].prices.push(r))):"studio 1"===l||"studio 2"===l||"casita 5"===l||"casita 6"===l?(console.log("✅ Matched as Casa Deluxe"),a["casas-deluxe"].categories.push(e),n[l].roomType="casas-deluxe",r&&r>0&&(e.available_rooms||0)>0&&(a["casas-deluxe"].prices.push(r),n[l].prices.push(r))):(console.log(`❌ CATEGORY NOT INCLUDED: "${e.name}"`),console.log(`❌ This category is not part of the valid accommodation types`),console.log(`❌ Only these categories are valid:`),console.log('   - Casa de Playa: "Casa Playa"'),console.log('   - Casitas Privadas: "Casita 3", "Casita 4", "Casita 7"'),console.log('   - Casas Deluxe: "Studio 1", "Studio 2", "Casita 5", "Casita 6"'))})}),Object.keys(a).forEach(e=>{let o=a[e],s=0;Object.entries(n).forEach(([a,o])=>{if(o.roomType===e){let e=o.availableByDay.length>0?Math.min(...o.availableByDay):0;console.log(`🏠 Category "${a}" - Days: [${o.availableByDay.join(", ")}] - Min: ${e}`),s+=e}}),o.availableRoomsByDay=[s],console.log(`🎯 ${e} - Total available for all days: ${s}`)});let p=[];if(Object.entries(a).forEach(([e,a])=>{let o=null;if(a.prices.length>0){if("casa-playa"===e){let e=a.prices.find(e=>20===e);if(e)o=e;else{let e=a.prices.sort((e,a)=>e-a);o=e[Math.floor(e.length/2)]}}else{let e=a.prices.sort((e,a)=>e-a);o=e[Math.floor(e.length/2)]}}let s=a.availableRoomsByDay.length>0?a.availableRoomsByDay[0]:0;p.push({roomTypeId:a.roomTypeId,roomTypeName:a.roomTypeName,pricePerNight:o,realPrice:o,priceSource:o?"LOBBYPMS_AVAILABLE_ROOMS_API":null,maxGuests:a.maxGuests,availableRooms:s,available:s>0,debug:{originalCategory:a.categories[0]||null,source:"available-rooms-endpoint",allCategories:a.categories.map(e=>e.name),allPrices:a.prices,availableRoomsByDay:a.availableRoomsByDay,minAvailableRooms:s}})}),console.log("\uD83C\uDFAF ===== FINAL RESULT WITH REAL PRICES ====="),console.log("\uD83C\uDFAF Available rooms:",p.length),p.forEach((e,a)=>{console.log(`🏠 ${a+1}. ${e.roomTypeName}:`),console.log(`   💰 Real Price: $${e.realPrice} (${e.priceSource||"NO_PRICE"})`),console.log(`   🛏️ Available: ${e.availableRooms} (min across days)`),console.log(`   📅 By day: [${e.debug.availableRoomsByDay.join(", ")}]`),console.log(`   📊 All prices: [${e.debug.allPrices.join(", ")}]`),console.log(`   🏷️ Categories: [${e.debug.allCategories.join(", ")}]`)}),0===p.length)return i.Z.json({success:!1,error:"No rooms available for the selected dates",debug:{totalDaysProcessed:e.length,availabilityData:e,message:"No matching room categories found"}},{status:404});let g={success:!0,available:!0,maxGuests:12,availableRooms:p,debug:{totalDaysFromAPI:e.length,endpointUsed:"/available-rooms",priceAnalysis:p.map(e=>({room:e.roomTypeName,price:e.pricePerNight,realPrice:e.realPrice,source:e.priceSource}))}};return console.log("\uD83D\uDCE4 Returning result with REAL prices from correct endpoint:",JSON.stringify(g,null,2)),i.Z.json(g)}catch(a){console.error("❌ LobbyPMS API error:",a.message),console.error("❌ Full error details:",{message:a.message,name:a.name,stack:a.stack,response:a.response?.data});let e=a.message&&a.message.includes("HTML");return i.Z.json({success:!1,error:e?"LobbyPMS API est\xe1 devolviendo HTML en lugar de JSON - posible problema de IP o autenticaci\xf3n":"Error de conexi\xf3n con LobbyPMS",debug:{errorType:a.name,message:a.message,suggestion:e?"Verifica que tu IP est\xe1 autorizada en LobbyPMS y que el API token es v\xe1lido":"Endpoint /available-rooms failed - check API credentials and IP authorization",endpointUsed:"/available-rooms",isHtmlError:e,timestamp:new Date().toISOString()}},{status:503})}}catch(e){return console.error("❌ General availability error:",e),i.Z.json({success:!1,error:"Error checking availability",details:e.message},{status:500})}}let c=new l.AppRouteRouteModule({definition:{kind:r.x.APP_ROUTE,page:"/api/availability/route",pathname:"/api/availability",filename:"route",bundlePath:"app/api/availability/route"},resolvedPagePath:"C:\\Users\\loko_\\OneDrive\\Desktop\\Escritorio\\surfcamp\\app\\api\\availability\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:n,staticGenerationAsyncStorage:u,serverHooks:p,headerHooks:g,staticGenerationBailout:y}=c,m="/api/availability/route"}};var a=require("../../../webpack-runtime.js");a.C(e);var __webpack_exec__=e=>a(a.s=e),o=a.X(0,[997,806,117,614],()=>__webpack_exec__(82));module.exports=o})();